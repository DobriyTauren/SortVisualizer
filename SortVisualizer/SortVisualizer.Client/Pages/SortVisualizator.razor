@page "/SortVisualizator"
@rendermode InteractiveWebAssembly

<div class="vis-container">
    <div style="min-width: 70%;">
        <div class="container">
            <div class="row">
                <div class="col-sm mb-2 mx-2 bg-primary bg-gradient rounded border border-info">
                    <p class="text-light text-center my-auto">Обращений к массиву: @SortService.ArrayAccessCount</p>
                </div>
                <div class="col mb-2 mx-2 bg-primary bg-gradient rounded border border-info">
                    <p class="text-light text-center my-auto">Перестановок: @SortService.SwapCount</p>
                </div>
                <div class="col mb-2 mx-2 bg-primary bg-gradient rounded border border-info">
                    <p class="text-light text-center my-auto">Сравнений: @SortService.CompareCount </p>
                </div>
            </div>
        </div>

        <div class="sort-item-container">
            @foreach (var element in ArrayElements)
            {
                <div class="sort-item" style="--sort-item-color: @element.Color;
                                              --sort-item-height: @element.Height;">
                    @element.Text
                </div>
            }
        </div>

        <div class="row btn-container">
            <div class="col-auto">
                <button class="btn btn-primary" @onclick="GenerateArray" disabled="@_isSorting">Сгенерировать</button>
            </div>
            <div class="col-auto mb-2">
                <button class="btn btn-primary" @onclick="SortArray" disabled="@(_isEmpty || _isSorting)">Сортировать</button>
            </div>
            <div class="col-auto pt-2">
                <p class="text-light text-center">Задержка (мс)</p>>
            </div>

            <div class="col-3 mb-2 w-7">
                <input @bind="_delay" disabled="@_isSorting" type="text" class="form-control" id="inlineFormInputGroup" placeholder="Задержка">
            </div>
        </div>
    </div>
</div>


@code
{
    [Parameter]
    public SortAlgorithm Algorithm { get; set; }

    private List<ArrayElement> ArrayElements { get; set; } = new List<ArrayElement>();

    public delegate Task SortAlgorithm(List<ArrayElement> arrayElements);

    private int _delay = 10;

    private bool _isSorting = false;
    private bool _isEmpty = true;

    protected override void OnInitialized()
    {
        SortService.StyleChanged += HandleStateChanged;
    }

    private void GenerateArray()
    {
        ArrayElements.Clear();
        ArrayElements = SortService.GenerateArray();

        _isEmpty = false;
    }

    private async Task SortArray()
    {
        SortService.Delay = _delay;

        _isSorting = true;
        await Algorithm(ArrayElements);

        _isSorting = false;
        StateHasChanged();
    }

    private void HandleStateChanged(object sender, EventArgs e)
    {
        StateHasChanged(); // обновление состояния компонента
    }
}


<style>

    .btn-container {
        padding: 12px 0 0 10px;
    }

    .w-10 {
        width: 10%;
        min-width: 68px;
    }

    .w-7 {
        width: 7%;
        min-width: 68px;
    }


    .w-15 {
        width: 15%;
    }

    .w-30 {
        width: 30%;
    }

    .sort-item-container {
        padding-left: 10px;
        margin-top: 10px;
        min-height: 310px;
        display: flex;
    }

    .sort-item {
        width: 1.2vw;
        height: var(--sort-item-height);
        background-color: var(--sort-item-color);
        margin-right: 0.2vw;
        display: inline-block;
        transition: height 0.25s ease-in-out;
        display: inline-block;
        align-self: flex-end;
        color: whitesmoke;
        font-size: 12px;
        text-align: center;
        min-width: 7.1px;
    }

    .vis-container {
        background: rgb(225,229,237);
        background: linear-gradient(180deg, rgba(0,120,255,1) 0%, rgba(0,0,50,1) 100%);
        height: 55vh;
        width: 100%;
        min-height: 560px;
        min-width: 350px;
        border-radius: 20px 20px 20px 20px;
        padding-right: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
</style>